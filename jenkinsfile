node{
    
    def mvnHome = tool 'Maven3.8.6'
    def mvnCMD ="${mvnHome}/bin/mvn"
    
    environment {
       registryName = 'edhriacr2022'
       registryUrl = 'edhriacr2022.azurecr.io'
       registryCredential = 'myACR'
       dockerImage = ''
    }
    
    
    // Checkout Git Branches
    stage ("Checkout Branches")  {
       
       checkout([$class: 'GitSCM', branches: [[name: '*/main']], extensions: [], userRemoteConfigs: [[url: 'https://github.com/Mohamed-Edhri/eShop.git']]])
    }
    
    // Build Application Code
    stage ('Build Code Application')  {
        
    sh '${mvnHome}/bin/mvn clean install -f shopfront/pom.xml'
    
    }
    
    // Build Docker images 
    stage ('Build Docker Image')  {
        
    sh 'docker build -t edhriacr2022/shopfront:1.0 .'

    }
    
    // Push Docker images into ACR
     stage('Push Docker Image to ACR') {
       
        sh 'docker push edhriacr2022.azurecr.io/shopfront:1.0'
      
   }
    
}

